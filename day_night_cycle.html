<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body
        {
            margin: 0%;
        }
    </style>
</head>
<body>
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "./three.module.js",
                "three/addons/": "./jsm/"
            }
        }
    </script>
    <script type="module">
        //https://threejs.org/docs/index.html?q=light#api/en/lights/DirectionalLight
        //https://threejs.org/examples/?q=sun#webgl_shaders_sky
        import * as THREE from 'three';
        import { Sky } from 'three/addons/objects/Sky.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const clock = new THREE.Clock();
        let scene = new THREE.Scene();

        let camera = new THREE.PerspectiveCamera(75,window.innerWidth / window.innerHeight,0.2,5000);
        scene.add(camera);
        camera.position.set(0, 5, 5);
        camera.lookAt(0, 0, 0);


        let renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize(window.innerWidth,window.innerHeight);
        renderer.outputEncoding = THREE.sRGBEncoding;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 0.5;
        document.body.appendChild(renderer.domElement);

        const sky = new Sky();
        sky.scale.setScalar( 450000 );
        scene.add( sky );

        const sun = new THREE.Vector3();

        const effectController = {
					turbidity: 10,
					rayleigh: 3,
					mieCoefficient: 0.005,
					mieDirectionalG: 0.7,
					elevation: 0,
					azimuth: 180,
					exposure: 0.5
				};

        renderer.toneMappingExposure = effectController.exposure;
        renderer.render( scene, camera );

        const directionalLight = new THREE.DirectionalLight(0xffffff);
        scene.add(directionalLight);

        const controls = new OrbitControls( camera, renderer.domElement );
        controls.addEventListener( 'change', render );

        // ************************** //
        // Create a ground plane
        // ************************** //
        let blockPlane = new THREE.Mesh(new THREE.BoxGeometry(), new THREE.MeshPhongMaterial(
                {
                    color: 0xffffff
                }));
        blockPlane.position.set(0,-2,0);
        blockPlane.scale.set(10,1,10);
        blockPlane.castShadow = true;
        blockPlane.receiveShadow = true;
        scene.add(blockPlane);


        // ************************** //
        // Create a cube
        // ************************** //
        // Cube center is at (0,0,0)
        const cubeGeometry = new THREE.BoxGeometry(1, 1, 1);
        const cubeMaterial = new THREE.MeshPhongMaterial({ color: 'rgb(255,0,0)' });
        const cubeObject = new THREE.Mesh(cubeGeometry, cubeMaterial);
        scene.add(cubeObject);

        // Set shadow property
        cubeObject.castShadow = true;
        cubeObject.receiveShadow = true;

        // Name
        cubeObject.name = "cube";

        // ************************** //
        // Create a sphere
        // ************************** //
        // Sphere center is at (0,0,0)
        const sphereGeometry = new THREE.SphereGeometry(0.5, 32, 32);
        const sphereMaterial = new THREE.MeshPhongMaterial({ color: 'rgb(180,180,255)' });
        const sphereObject = new THREE.Mesh(sphereGeometry, sphereMaterial);
        scene.add(sphereObject);

        // Set position of the sphere
        // Move to the left and away from (0,0,0)
        // The sphere touches the plane
        sphereObject.translateX(-1.2).translateY(0.5).translateZ(-0.5);

        // Set shadow property
        sphereObject.castShadow = true;
        sphereObject.receiveShadow = true;


        animate();

        function animate()
        {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            const speed = 10;
            const uniforms = sky.material.uniforms;
            const phi = THREE.MathUtils.degToRad( 90 - effectController.elevation );
            const theta = THREE.MathUtils.degToRad( effectController.azimuth );

            sun.setFromSphericalCoords( 1, phi, theta );

            uniforms[ 'sunPosition' ].value.copy( sun );
            directionalLight.position.copy(sun);
            effectController.elevation += 1 * delta * speed;
            render();
        }

        function render()
        {
            renderer.render(scene,camera);
        }
    </script>
</body>
</html>